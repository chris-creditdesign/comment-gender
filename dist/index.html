<style scoped>
.status-message{border:1px solid #c00;background:#fac7c7;padding:10px}.outer-wrapper{border:1px solid #c8c7cf;display:none;padding:0 0 10px}.outer-wrapper:after{content:".";visibility:hidden;display:block;height:0;clear:both}.outer-wrapper h2,.outer-wrapper h3,.outer-wrapper p.grahpicStandfirst{padding:10px 10px 0}.outer-wrapper .count-chart{position:relative;height:350px;width:630px}.outer-wrapper .count-chart .infobox{position:absolute;padding:10px;background-color:#333;pointer-events:none;opacity:0;z-index:100}.outer-wrapper .count-chart .infobox p{margin:0;color:#ecf0f1;font-family:sans-serif;font-size:16px;line-height:20px}.outer-wrapper .count-chart .infobox:before{content:"";position:absolute;bottom:-10px;left:49%;border-right:0;border-top:10px solid #333;border-bottom:0;border-left:10px solid transparent}.outer-wrapper .count-chart .infobox.hidden{display:none}.outer-wrapper .count-chart .axis line,.outer-wrapper .count-chart .axis path{fill:none;stroke:#666;shape-rendering:crispEdges}.outer-wrapper .count-chart .axis text{font-family:sans-serif;fill:#666;font-size:13px;shape-rendering:crispEdges}.outer-wrapper .count-chart .x.axis text{font-size:12px;cursor:default}.outer-wrapper .count-chart rect{shape-rendering:crispEdges;-webkit-transition:fill 125ms linear;-moz-transition:fill 125ms linear;-ms-transition:fill 125ms linear;-o-transition:fill 125ms linear;transition:fill 125ms linear}.outer-wrapper .wrapper{width:630px;padding:0 0 0 15px;float:left;clear:left;box-sizing:border-box}.outer-wrapper .wrapper h2{text-transform:uppercase;font-size:1.1em;letter-spacing:.1em;text-align:center;color:#666;padding:10px 0 5px;margin:0 0 5px}.outer-wrapper .wrapper p{font-size:1.1em;line-height:1.4em;padding:10px 0 0;text-align:center;font-weight:400;color:#666}.outer-wrapper .wrapper form label{float:left;width:165px;margin:0 10px 6px 0;padding:0 0 0 30px;position:relative;-webkit-backface-visibility:hidden;display:block;cursor:pointer;-webkit-transition:color 250ms linear;-moz-transition:color 250ms linear;-ms-transition:color 250ms linear;-o-transition:color 250ms linear;transition:color 250ms linear}.outer-wrapper .wrapper form label:hover{color:#a0bec5}.outer-wrapper .wrapper form label input{outline:0!important;opacity:0;filter:alpha(opacity=0);zoom:1;float:left;margin-left:-40px}.outer-wrapper .wrapper form label span{display:block;height:20px;left:0;opacity:1;position:absolute;top:2px;width:20px;-webkit-backface-visibility:hidden}.outer-wrapper .wrapper form label.checkbox{fill:#ecf0f1}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots{fill:#a0bec5;opacity:.8;-webkit-transition:fill 250ms linear;-moz-transition:fill 250ms linear;-ms-transition:fill 250ms linear;-o-transition:fill 250ms linear;transition:fill 250ms linear}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots.Australasia{fill:#1abc9c}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots.North_America{fill:#27ae60}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots.Asia{fill:#3498db}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots.Europe{fill:#5959b7}.outer-wrapper .wrapper form label.checkbox.checked .icon .dots.South_America{fill:#eb6b4b}.outer-wrapper .wrapper form.field-select label{width:260px}
</style>
<p class="status-message"><em>The interactive companion to this table requires a modern browser (e.g. Chrome, Safari, Firefox or Internet Explorer 9+) with javascript enabled.</em></p>

<div class="outer-wrapper">

	<h2>INTERACTIVE: Gender, output, collaboration and citation</h2>
	<p class="grahpicStandfirst">Scientists in these 30 countries contributed the largest shares of the more than 5 million papers published between 2008 and 2012. Explore below to discover what proportion of output was contributed by women and men, and how the gender of lead authors influenced the citation of papers from lone authors, national and international collaborations.</p>
	
	<h3>Total papers published</h3>
	<div class="count-chart">
		<div class="infobox hidden">
			<p><span class="value"></span></p>
		</div>
	</div><!-- count-chart -->

	<div class="wrapper">
	<h2>Field</h2>
		<form class="field-select">

			<label class="checkbox checked" for="TotalPaper">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots TotalPaper'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="TotalPaper" value="TotalPaper" checked>
				<strong>Total papers published</strong>
			</label>
			<label class="checkbox" for="FMRatio">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots FMRatio'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>
				<input type="radio" name="mode" id="FMRatio" value="FMRatio">
				<strong>Female to Male Ratio</strong>
			</label>
			<label class="checkbox" for="Single">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots Single'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="Single" value="Single">
				Single author
			</label>
			<label class="checkbox" for="NatFirst">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots NatFirst'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="NatFirst" value="NatFirst">
				First author (national collaboration)
			</label>
			<label class="checkbox" for="NatLast">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots NatLast'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="NatLast" value="NatLast">
				Last author (national collaboration)
			</label>
			<label class="checkbox" for="IntFirst">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots IntFirst'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="IntFirst" value="IntFirst">
				First author (international collaboration)
			</label>
			<label class="checkbox" for="IntLast">
				<span class='icon'>
					<svg height='20' width='20'>
						<circle cx='10' cy='10' r='10' class='dots IntLast'></circle>
						<polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon>
					</svg>
				</span>	
				<input type="radio" name="mode" id="IntLast" value="IntLast">
				Last author (international collaboration)
			</label>
		</form>
	</div><!--class="field-wrapper"-->

	<div class="wrapper">
		<h2>Continent</h2>
		<form class="continent-select">
		</form>
	</div>

	<div class="wrapper">
		<h2>Country</h2>
		<form class="country-select">
		</form>
	</div><!--wrapper country-wrapper-->

</div> <!-- outer-wrapper -->
<!--[if gt IE 8]><!-->
<script type="text/javascript">
<<<<<<< HEAD
!function(){var a=function(a){a(".outer-wrapper").css({display:"block"}),a(".status-message").css({display:"none"});var b=["#1abc9c","#27ae60","#3498db","#5959b7","#EB6B4B"],c={top:15,right:20,bottom:20,left:90},d=630-c.left-c.right,e=350-c.top-c.bottom,f=450,g=[],h=[],i=[],j="TotalPaper",k="Total papers published",l="Papers published",m=[],n=[],o=["All"],p=[],q=!0;a.getScript("http://d3js.org/d3.v3.min.js",function(){function r(){var b=".checkbox",c=b+" input[type='checkbox']",d=b+" input[type='radio']",e="checked";a(b).each(function(){a(this).removeClass(e)}),a(c+":checked").each(function(){a(this).parent(b).addClass(e)}),a(d+":checked").each(function(){a(this).parent(b).addClass(e)})}function s(a,b){return a.country<b.country?-1:a.country>b.country?1:0}var t=d3.select(".count-chart").append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom),u=t.append("g").attr("transform","translate("+c.left+",0)"),v=t.append("g").attr("transform","translate("+c.left+",0)"),w=t.append("g").attr("class","x axis").attr("transform","translate("+c.left+",0)"),x=t.append("g").attr("class","axis").attr("transform","translate(-57,-5)").attr("opacity",0);x.append("rect").attr("x",d+c.left-50).attr("y",e+c.top+c.bottom-10).attr("width","10").attr("height","10").attr("opacity",.6).attr("fill","#34495e").attr("stroke","none"),x.append("text").attr("x",d+c.left-35).attr("y",e+c.top+c.bottom).style("text-anchor","start").text("Male"),x.append("rect").attr("x",d+c.left).attr("y",e+c.top+c.bottom-10).attr("width","10").attr("height","10").attr("fill","#34495e").attr("stroke","none"),x.append("text").attr("x",d+c.left+15).attr("y",e+c.top+c.bottom).style("text-anchor","start").text("Female");var y=d3.format(",");a.ajax({url:"data/citation-data.html",dataType:"text",success:function(z){function A(){for(;m.length>0;)m.shift();for(;i.length>0;)i.shift();for(;h.length>0;)h.shift();for(;h.length>0;)h.shift();for(var a=0;a<g.length;a++)i.push({});for(var b=0;b<i.length;b++)i[b].country=g[b].country,i[b].countryCode=g[b].countryCode,i[b].continent=g[b].continent;switch(j){case"TotalPaper":for(var c=0;c<i.length;c++)i[c].choice=g[c].TotalPaper,i[c].choiceFemale=0;break;case"Single":for(var d=0;d<i.length;d++)i[d].choice=g[d].SingleM,i[d].choiceFemale=g[d].SingleF;break;case"NatFirst":for(var e=0;e<i.length;e++)i[e].choice=g[e].NatFirstM,i[e].choiceFemale=g[e].NatFirstF;break;case"NatLast":for(var f=0;f<i.length;f++)i[f].choice=g[f].NatLastM,i[f].choiceFemale=g[f].NatLastF;break;case"IntFirst":for(var k=0;k<i.length;k++)i[k].choice=g[k].IntFirstM,i[k].choiceFemale=g[k].IntFirstF;break;case"IntLast":for(var l=0;l<i.length;l++)i[l].choice=g[l].IntLastM,i[l].choiceFemale=g[l].IntLastF;break;case"FMRatio":for(var n=0;n<i.length;n++)i[n].choice=g[n].FMRatio,i[n].choiceFemale=0;break;default:for(var o=0;o<i.length;o++)i[o].choice=g[o].TotalPaper,i[o].choiceFemale=0}for(var p=0;p<i.length;p++){var q=i[p].country;d3.select(".country-select [value="+q+"]").property("checked")&&m.push(i[p])}C(),F(),r()}function B(){var b=a(this).val();if("All"===b)a(".continent-select input").prop("checked",a(this).prop("checked")),a(".country-select input").prop("checked",a(this).prop("checked"));else for(var c=0;c<a(".country-select input").length;c++){var d=a(".country-select input").eq(c);b===d.data("continent")&&d.prop("checked",a(this).prop("checked"))}A()}function C(){switch(j){case"TotalPaper":case"FMRatio":K.domain([0,d3.max(m,function(a){return a.choice})]);break;case"Single":case"NatFirst":case"NatLast":case"IntFirst":case"IntLast":K.domain([0,1.7]);break;default:K.domain([0,d3.max(m,function(a){return a.choice})])}m.length>5?M.domain(d3.range(m.length)):M.domain(d3.range(5));var a=u.selectAll("rect").data(m,function(a){return a.country}),d=v.selectAll("rect").data(m,function(a){return a.country});p.push(a[0].length),q=p.slice(-2)[1]>=p.slice(-2)[0]?!0:!1,p.shift(),a.enter().append("rect").attr("x",function(a,b){return M(b)}).attr("width",function(){return"TotalPaper"==j||"FMRatio"==j?M.rangeBand():M.rangeBand()/2}).attr("y",e+c.top).attr("height",0).attr("opacity",.6).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d.enter().append("rect").attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("width",M.rangeBand()/2).attr("y",e+c.top).attr("height",0).attr("opacity",1).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),a.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)}).attr("width",function(){return"TotalPaper"==j||"FMRatio"==j?M.rangeBand():M.rangeBand()/2}).attr("y",function(a){return c.top+K(a.choice)}).attr("height",function(a){return e-K(a.choice)}),d.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("width",M.rangeBand()/2).attr("y",function(a){return c.top+K(a.choiceFemale)}).attr("height",function(a){return e-K(a.choiceFemale)}),a.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",e+c.top).attr("height",0).remove(),d.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",e+c.top).attr("height",0).remove();var g=w.selectAll("text").data(m,function(a){return a.country});g.enter().append("text").attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("y",function(){return e+c.top}).attr("text-anchor","middle").text(function(a){return a.countryCode}),g.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("y",function(a){return a.choiceFemale>=a.choice?c.top+K(a.choiceFemale)-4:c.top+K(a.choice)-4}),g.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("y",e+c.top).remove(),t.select(".outer-wrapper .y").transition().duration(f).call(L),a.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(this).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(this).attr("fill","#f1c40f"),d3.select(d[0][c]).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(a,c){d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(d[0][c]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()}),d.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][c]).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(a[0][c]).attr("fill","#f1c40f"),d3.select(this).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(c,d){d3.select(a[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()}),g.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][c]).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(a[0][c]).attr("fill","#f1c40f"),d3.select(d[0][c]).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(c,e){d3.select(a[0][e]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(d[0][e]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()})}function D(b,c,d,e,g){var h,i="",k=b.replace(/_/g," ");h="TotalPaper"==j?y(c):c,i="TotalPaper"==j||"FMRatio"==j?k+"<br /> "+h:k+"<br />Male: "+c+"<br />Female: "+d,d3.select(".infobox").select(".value").html(i);var l=parseInt(a(".infobox").css("width"),10),m=parseInt(a(".infobox").css("height"),10),n=parseInt(e,10)-l/2+75,o=parseInt(g,10)-m-43;d3.select(".infobox").style("left",n+"px").style("top",o+"px"),d3.select(".infobox").classed("hidden",!1).transition().duration(f/2).style("opacity",1)}function E(){d3.select(".infobox").transition().duration(f/2).style("opacity",0).each("end",function(){d3.select(".infobox").classed("hidden",!0)})}function F(){switch(j){case"TotalPaper":k="Total papers published",l="Papers published",x.transition().duration(f).attr("opacity",0);break;case"Single":k="Single author",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"NatFirst":k="First author (national collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"NatLast":k="Last author (national collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"IntFirst":k="First author (international collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"IntLast":k="Last author (international collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"FMRatio":k="Ratio of female to male authorships",l="Ratio of female to male authorships",x.transition().duration(f).attr("opacity",0);break;default:k="Total papers published",l="Papers published",x.transition().duration(f).attr("opacity",1)}d3.select(".outer-wrapper h3").text(k),d3.selectAll(".y .axisLabel text").text(l)}for(var G=a(z).find("tbody tr"),H=0;H<G.length;H++){var I={};I.country=G.eq(H).find("td").eq(0).text(),I.countryCode=G.eq(H).find("td").eq(1).text(),I.continent=G.eq(H).find("td").eq(2).text(),I.TotalPaper=parseInt(G.eq(H).find("td").eq(3).text(),10),I.SingleF=parseFloat(G.eq(H).find("td").eq(4).text()),I.SingleM=parseFloat(G.eq(H).find("td").eq(5).text()),I.NatFirstF=parseFloat(G.eq(H).find("td").eq(6).text()),I.NatFirstM=parseFloat(G.eq(H).find("td").eq(7).text()),I.NatLastF=parseFloat(G.eq(H).find("td").eq(8).text()),I.NatLastM=parseFloat(G.eq(H).find("td").eq(9).text()),I.IntFirstF=parseFloat(G.eq(H).find("td").eq(10).text()),I.IntFirstM=parseFloat(G.eq(H).find("td").eq(11).text()),I.IntLastF=parseFloat(G.eq(H).find("td").eq(12).text()),I.IntLastM=parseFloat(G.eq(H).find("td").eq(13).text()),I.FMRatio=parseFloat(G.eq(H).find("td").eq(14).text()),g.push(I)}var J=g.length;p.push(J),n=g.map(function(a){return a.continent}),a.each(n,function(b,c){-1===a.inArray(c,o)&&o.push(c)}),d3.selectAll(".continent-select").selectAll("label").data(o.sort()).enter().append("label").attr("class","checkbox").html(function(a){var b=a.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots "+a+"'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a+"' data-continent='"+a+"' checked>"+b}),d3.selectAll(".country-select").selectAll("label").data(g.sort(s)).enter().append("label").attr("class","checkbox").html(function(a){var b=a.country.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a.country+"' data-continent='"+a.continent+"' checked>"+b+" ("+a.countryCode+")"}),d3.selectAll(".field-select input").on("change",function(){j=this.value,A(),F(j)}),d3.selectAll(".country-select input").on("change",A),d3.selectAll(".continent-select input").on("change",B);var K=d3.scale.linear().range([e,0]),L=d3.svg.axis().scale(K).tickSize(3,3).orient("left");t.append("g").attr("class","y axis").attr("transform","translate("+c.left+","+c.top+")").append("g").attr("class","axisLabel").append("text").attr("transform","rotate(-90)").attr("y",15-c.left).attr("x",-e).attr("dy",".9em").style("text-anchor","start");var M=d3.scale.ordinal().domain(d3.range(g.length)).rangeRoundBands([0,d+c.right],.4);A(),r()}})})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();
=======
var allBars=["#1abc9c","#27ae60","#3498db","#5959b7","#EB6B4B"];!function(){var a=function(a){a(".outer-wrapper").css({display:"block"}),a(".status-message").css({display:"none"});var b={top:15,right:20,bottom:20,left:75},c=630-b.left-b.right,d=350-b.top-b.bottom,e=450,f=[],g=[],h=[],i="TotalPaper",j="Total papers published",k="Papers published",l=[],m=[],n=["All"],o=[],p=!0;a.getScript("http://d3js.org/d3.v3.min.js",function(){function q(){var b=".checkbox",c=b+" input[type='checkbox']",d=b+" input[type='radio']",e="checked";a(b).each(function(){a(this).removeClass(e)}),a(c+":checked").each(function(){a(this).parent(b).addClass(e)}),a(d+":checked").each(function(){a(this).parent(b).addClass(e)})}function r(a,b){return a.country<b.country?-1:a.country>b.country?1:0}var s=d3.select(".count-chart").append("svg").attr("width",c+b.left+b.right).attr("height",d+b.top+b.bottom),t=s.append("g").attr("transform","translate("+b.left+",0)"),u=s.append("g").attr("transform","translate("+b.left+",0)"),v=s.append("g").attr("class","x axis").attr("transform","translate("+b.left+",0)"),w=s.append("g").attr("class","axis").attr("transform","translate(-49,-5)").attr("opacity",0);w.append("rect").attr("x",c+b.left-50).attr("y",d+b.top+b.bottom-10).attr("width","10").attr("height","10").attr("opacity",.6).attr("fill","#34495e").attr("stroke","none"),w.append("text").attr("x",c+b.left-35).attr("y",d+b.top+b.bottom).style("text-anchor","start").text("Male"),w.append("rect").attr("x",c+b.left).attr("y",d+b.top+b.bottom-10).attr("width","10").attr("height","10").attr("fill","#34495e").attr("stroke","none"),w.append("text").attr("x",c+b.left+15).attr("y",d+b.top+b.bottom).style("text-anchor","start").text("Female");var x=d3.format(",");a.ajax({url:"data/citation-data.html",dataType:"text",success:function(y){function z(){for(;l.length>0;)l.shift();for(;h.length>0;)h.shift();for(;g.length>0;)g.shift();for(;g.length>0;)g.shift();for(var a=0;a<f.length;a++)h.push({});for(var b=0;b<h.length;b++)h[b].country=f[b].country,h[b].countryCode=f[b].countryCode,h[b].continent=f[b].continent;switch(i){case"TotalPaper":for(var c=0;c<h.length;c++)h[c].choice=f[c].TotalPaper,h[c].choiceFemale=0;break;case"Single":for(var d=0;d<h.length;d++)h[d].choice=f[d].SingleM,h[d].choiceFemale=f[d].SingleF;break;case"NatFirst":for(var e=0;e<h.length;e++)h[e].choice=f[e].NatFirstM,h[e].choiceFemale=f[e].NatFirstF;break;case"NatLast":for(var j=0;j<h.length;j++)h[j].choice=f[j].NatLastM,h[j].choiceFemale=f[j].NatLastF;break;case"IntFirst":for(var k=0;k<h.length;k++)h[k].choice=f[k].IntFirstM,h[k].choiceFemale=f[k].IntFirstF;break;case"IntLast":for(var m=0;m<h.length;m++)h[m].choice=f[m].IntLastM,h[m].choiceFemale=f[m].IntLastF;break;case"FMRatio":for(var n=0;n<h.length;n++)h[n].choice=f[n].FMRatio,h[n].choiceFemale=0;break;default:for(var o=0;o<h.length;o++)h[o].choice=f[o].TotalPaper,h[o].choiceFemale=0}for(var p=0;p<h.length;p++){var r=h[p].country;d3.select(".country-select [value="+r+"]").property("checked")&&l.push(h[p])}B(),E(),q()}function A(){var b=a(this).val();if("All"===b)a(".continent-select input").prop("checked",a(this).prop("checked")),a(".country-select input").prop("checked",a(this).prop("checked"));else for(var c=0;c<a(".country-select input").length;c++){var d=a(".country-select input").eq(c);b===d.data("continent")&&d.prop("checked",a(this).prop("checked"))}z()}function B(){J.domain([0,d3.max(l,function(a){return a.choice})]),l.length>5?L.domain(d3.range(l.length)):L.domain(d3.range(5));var a=t.selectAll("rect").data(l,function(a){return a.country}),c=u.selectAll("rect").data(l,function(a){return a.country});o.push(a[0].length),p=o.slice(-2)[1]>=o.slice(-2)[0]?!0:!1,o.shift(),a.enter().append("rect").attr("x",function(a,b){return L(b)}).attr("width",function(){return"TotalPaper"==i||"FMRatio"==i?L.rangeBand():L.rangeBand()/2}).attr("y",d+b.top).attr("height",0).attr("opacity",.6).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),c.enter().append("rect").attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("width",L.rangeBand()/2).attr("y",d+b.top).attr("height",0).attr("opacity",1).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),a.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)}).attr("width",function(){return"TotalPaper"==i||"FMRatio"==i?L.rangeBand():L.rangeBand()/2}).attr("y",function(a){return b.top+J(a.choice)}).attr("height",function(a){return d-J(a.choice)}),c.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("width",L.rangeBand()/2).attr("y",function(a){return b.top+J(a.choiceFemale)}).attr("height",function(a){return d-J(a.choiceFemale)}),a.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",d+b.top).attr("height",0).remove(),c.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",d+b.top).attr("height",0).remove();var f=v.selectAll("text").data(l,function(a){return a.country});f.enter().append("text").attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("y",function(){return d+b.top}).attr("text-anchor","middle").text(function(a){return a.countryCode}),f.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("y",function(a){return a.choiceFemale>=a.choice?b.top+J(a.choiceFemale)-4:b.top+J(a.choice)-4}),f.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("y",d+b.top).remove(),s.select(".outer-wrapper .y").transition().duration(e).call(K),a.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(this).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(this).attr("fill","#f1c40f"),d3.select(c[0][d]).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(a,b){d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(c[0][b]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()}),c.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][d]).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(a[0][d]).attr("fill","#f1c40f"),d3.select(this).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(b,c){d3.select(a[0][c]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()}),f.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][d]).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(a[0][d]).attr("fill","#f1c40f"),d3.select(c[0][d]).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(b,d){d3.select(a[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(c[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()})}function C(b,c,d,f,g){var h,j="",k=b.replace(/_/g," ");h="TotalPaper"==i?x(c):c,j="TotalPaper"==i||"FMRatio"==i?k+"<br /> "+h:k+"<br />Male: "+c+"<br />Female: "+d,d3.select(".infobox").select(".value").html(j);var l=parseInt(a(".infobox").css("width"),10),m=parseInt(a(".infobox").css("height"),10),n=parseInt(f,10)-l/2+65,o=parseInt(g,10)-m-43;d3.select(".infobox").style("left",n+"px").style("top",o+"px"),d3.select(".infobox").classed("hidden",!1).transition().duration(e/2).style("opacity",1)}function D(){d3.select(".infobox").transition().duration(e/2).style("opacity",0).each("end",function(){d3.select(".infobox").classed("hidden",!0)})}function E(a){switch(a){case"TotalPaper":j="Total papers published",k="Papers published",w.transition().duration(e).attr("opacity",0);break;case"Single":j="Single",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"NatFirst":j="National first",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"NatLast":j="National last",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"IntFirst":j="International first",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"IntLast":j="International last",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"FMRatio":j="Female to male ratio",k="Female to male ratio",w.transition().duration(e).attr("opacity",0)}d3.select(".outer-wrapper h1").text(j),d3.selectAll(".y .axisLabel text").text(k)}for(var F=a(y).find("tbody tr"),G=0;G<F.length;G++){var H={};H.country=F.eq(G).find("td").eq(0).text(),H.countryCode=F.eq(G).find("td").eq(1).text(),H.continent=F.eq(G).find("td").eq(2).text(),H.TotalPaper=parseInt(F.eq(G).find("td").eq(3).text(),10),H.SingleF=parseFloat(F.eq(G).find("td").eq(4).text()),H.SingleM=parseFloat(F.eq(G).find("td").eq(5).text()),H.NatFirstF=parseFloat(F.eq(G).find("td").eq(6).text()),H.NatFirstM=parseFloat(F.eq(G).find("td").eq(7).text()),H.NatLastF=parseFloat(F.eq(G).find("td").eq(8).text()),H.NatLastM=parseFloat(F.eq(G).find("td").eq(9).text()),H.IntFirstF=parseFloat(F.eq(G).find("td").eq(10).text()),H.IntFirstM=parseFloat(F.eq(G).find("td").eq(11).text()),H.IntLastF=parseFloat(F.eq(G).find("td").eq(12).text()),H.IntLastM=parseFloat(F.eq(G).find("td").eq(13).text()),H.FMRatio=parseFloat(F.eq(G).find("td").eq(14).text()),f.push(H)}var I=f.length;o.push(I),m=f.map(function(a){return a.continent}),a.each(m,function(b,c){-1===a.inArray(c,n)&&n.push(c)}),d3.selectAll(".continent-select").selectAll("label").data(n.sort()).enter().append("label").attr("class","checkbox").html(function(a){var b=a.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots "+a+"'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a+"' data-continent='"+a+"' checked>"+b}),d3.selectAll(".country-select").selectAll("label").data(f.sort(r)).enter().append("label").attr("class","checkbox").html(function(a){var b=a.country.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a.country+"' data-continent='"+a.continent+"' checked>"+b+" ("+a.countryCode+")"}),d3.selectAll(".field-select input").on("change",function(){i=this.value,z(),E(i)}),d3.selectAll(".country-select input").on("change",z),d3.selectAll(".continent-select input").on("change",A);var J=d3.scale.linear().range([d,0]),K=d3.svg.axis().scale(J).tickSize(3,3).orient("left");s.append("g").attr("class","y axis").attr("transform","translate("+b.left+","+b.top+")").append("g").attr("class","axisLabel").append("text").attr("transform","rotate(-90)").attr("y",-b.left).attr("x",-d).attr("dy",".9em").style("text-anchor","start");var L=d3.scale.ordinal().domain(d3.range(f.length)).rangeRoundBands([0,c+b.right],.4);z(),q()}})})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();
>>>>>>> d8e0dc9e9dca28d99625e8ec58148e7935cb8811

</script>
<!--<![endif]-->