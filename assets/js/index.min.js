var colourPurple=["#DABDD8","#95177E","#B570A7","#651E59","#461E47"],colourYellow=["#FED162","#F8B436","#F29500","#D37510","#AF6A17"],colourRed=["#EE8361","#EB6B4B","#E85338","#E53524","#A8131D"],colourBlue=["#84D0F0","#3BAADC","#006DB2","#2C3387","#152760"],colourGreen=["#E1DC00","#96BE17","#45A72C","#00892F","#00642D"],colourText=["#363636","#707070","#006699","#5C7996","#222222","#EEEEEE","#F5821F","#C4C4C4"],colourBorder=["#999999","#E7E7E7","#C7C8CC","#B7B7B7","#D4D4D4","#CCCCCC","#006699","#C4C4C4"],colourBackground=["#006699","#2C2C2C","#E1E4E9","#ECECEC","#5E5E5E","#F9F9F9","#F0F1F3"],allBars=["#1abc9c","#27ae60","#3498db","#5959b7","#34495e"];!function(){var a=function(a){var b=a("#constrain-content"),c=a("#nav");setTimeout(function(){b&&c?(b.addClass("single-column"),c.remove()):setTimeout(arguments.callee,100)},100),a(".outer-wrapper").css({display:"block"}),a(".status-message").css({display:"none"});var d={top:30,right:20,bottom:15,left:75},e=630-d.left-d.right,f=350-d.top-d.bottom,g=450,h=[],i=[],j=[],k=[],l="TotalPaper",m="Total papers published",n="Papers published",o=[],p=[],q=["All"],r=[],s=!0,t=d3.select(".count-chart").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),u=t.append("g").attr("transform","translate("+d.left+",0)"),v=t.append("g").attr("class","x axis").attr("transform","translate("+d.left+",0)"),w=d3.format(",");a.ajax({url:"data/citation-data.html",dataType:"text",success:function(b){function c(){for(;o.length>0;)o.shift();for(;j.length>0;)j.shift();for(;k.length>0;)k.shift();for(;i.length>0;)i.shift();for(;i.length>0;)i.shift();for(var a=0;a<h.length;a++)k.push({});for(var b=0;b<k.length;b++)k[b].country=h[b].country,k[b].countryCode=h[b].countryCode,k[b].continent=h[b].continent;switch(l){case"TotalPaper":for(var c=0;c<k.length;c++)k[c].choice=h[c].TotalPaper;break;case"SingleF":for(var d=0;d<k.length;d++)k[d].choice=h[d].SingleF;break;case"SingleM":for(var e=0;e<k.length;e++)k[e].choice=h[e].SingleM;break;case"NatFirstF":for(var f=0;f<k.length;f++)k[f].choice=h[f].NatFirstF;break;case"NatFirstM":for(var g=0;g<k.length;g++)k[g].choice=h[g].NatFirstM;break;case"NatLastF":for(var m=0;m<k.length;m++)k[m].choice=h[m].NatLastF;break;case"NatLastM":for(var n=0;n<k.length;n++)k[n].choice=h[n].NatLastM;break;case"IntFirstF":for(var p=0;p<k.length;p++)k[p].choice=h[p].IntFirstF;break;case"IntFirstM":for(var q=0;q<k.length;q++)k[q].choice=h[q].IntFirstM;break;case"IntLastF":for(var r=0;r<k.length;r++)k[r].choice=h[r].IntLastF;break;case"IntLastM":for(var s=0;s<k.length;s++)k[s].choice=h[s].IntLastM;break;case"FMRatio":for(var t=0;t<k.length;t++)k[t].choice=h[t].FMRatio;break;default:for(var u=0;u<k.length;u++)k[u].choice=h[u].cc}for(var v=0;v<k.length;v++){var w=k[v].country;d3.select(".country-select [value="+w+"]").property("checked")&&o.push(k[v])}o.sort(function(a,b){return b.choice<a.choice?-1:b.choice>a.choice?1:b.choice===a.choice?a.country<b.country?-1:a.country>b.country?1:0:void 0}),y(),B()}function x(){var b=a(this).val();if("All"===b)a(".continent-select input").prop("checked",a(this).prop("checked")),a(".country-select input").prop("checked",a(this).prop("checked"));else for(var d=0;d<a(".country-select input").length;d++){var e=a(".country-select input").eq(d);b===e.data("continent")&&e.prop("checked",a(this).prop("checked"))}c()}function y(){G.domain([0,d3.max(o,function(a){return a.choice})]),o.length>5?I.domain(d3.range(o.length)):I.domain(d3.range(5));var a=u.selectAll("rect").data(o,function(a){return a.country});r.push(a[0].length),s=r.slice(-2)[1]>=r.slice(-2)[0]?!0:!1,r.shift(),a.enter().append("rect").attr("x",function(a,b){return I(b)}).attr("width",I.rangeBand()).attr("y",f+d.top).attr("height",0).attr("opacity",.8).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),a.transition().duration(g).delay(function(){return s?0:g}).attr("x",function(a,b){return I(b)}).attr("width",I.rangeBand()).attr("y",function(a){return d.top+G(a.choice)}).attr("height",function(a){return f-G(a.choice)}),a.exit().transition().duration(g).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",f+d.top).attr("height",0).remove();var b=v.selectAll("text").data(o,function(a){return a.country});b.enter().append("text").attr("x",function(a,b){return I(b)+I.rangeBand()/2}).attr("y",function(){return f+d.top}).attr("text-anchor","middle").text(function(a){return a.countryCode}),b.transition().duration(g).delay(function(){return s?0:g}).attr("x",function(a,b){return I(b)+I.rangeBand()/2}).attr("y",function(a){return d.top+G(a.choice)-2}),b.exit().transition().duration(g).attr("x",function(){return d3.select(this).attr("x")}).attr("y",f+d.top).remove(),t.select(".outer-wrapper .y").transition().duration(g).call(H),a.on("mouseover",function(a){var b=a.country,c=a.choice,d=d3.select(this).attr("x"),e=d3.select(this).attr("y");d3.select(this).attr("fill","#f1c40f"),z(b,c,d,e)}).on("mouseout",function(){d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"SAmerica":return allBars[4];default:return allBars[0]}}),A()}),b.on("mouseover",function(b,c){var d=b.country,e=b.choice,f=d3.select(a[0][c]).attr("x"),g=d3.select(a[0][c]).attr("y");d3.select(a[0][c]).attr("fill","#f1c40f"),z(d,e,f,g)}).on("mouseout",function(b,c){d3.select(a[0][c]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"SAmerica":return allBars[4];default:return allBars[0]}}),A()})}function z(b,c,d,e){var f,h=b.replace(/_/g," ");f="TotalPaper"==l?w(c):c,d3.select(".tooltip").select(".value").html(h+"<br /> "+f);var i=parseInt(a(".tooltip").css("width"),10),j=parseInt(a(".tooltip").css("height"),10),k=parseInt(d,10)-i/2+65,m=parseInt(e,10)-j-43;d3.select(".tooltip").style("left",k+"px").style("top",m+"px"),d3.select(".tooltip").classed("hidden",!1).transition().duration(g/2).style("opacity",1)}function A(){d3.select(".tooltip").transition().duration(g/2).style("opacity",0).each("end",function(){d3.select(".tooltip").classed("hidden",!0)})}function B(a){switch(a){case"TotalPaper":m="Total papers published",n="Papers published";break;case"SingleF":m="Single female",n="Citations";break;case"SingleM":m="Single male",n="Citations";break;case"NatFirstF":m="National first female",n="Citations";break;case"NatFirstM":m="National first male",n="Citations";break;case"NatLastF":m="National last female",n="Citations";break;case"NatLastM":m="National last male",n="Citations";break;case"IntFirstF":m="International first female",n="Citations";break;case"IntFirstM":m="International first male",n="Citations";break;case"IntLastF":m="International last female",n="Citations";break;case"IntLastM":m="International last male",n="Citations";break;case"FMRatio":m="Female to male ratio",n="Female to male ratio"}d3.select(".outer-wrapper h1").text(m),d3.selectAll(".y .axisLabel text").text(n)}for(var C=a(b).find("tbody tr"),D=0;D<C.length;D++){var E={};E.country=C.eq(D).find("td").eq(0).text(),E.countryCode=C.eq(D).find("td").eq(1).text(),E.continent=C.eq(D).find("td").eq(2).text(),E.TotalPaper=parseInt(C.eq(D).find("td").eq(3).text(),10),E.SingleF=parseFloat(C.eq(D).find("td").eq(4).text()),E.SingleM=parseFloat(C.eq(D).find("td").eq(5).text()),E.NatFirstF=parseFloat(C.eq(D).find("td").eq(6).text()),E.NatFirstM=parseFloat(C.eq(D).find("td").eq(7).text()),E.NatLastF=parseFloat(C.eq(D).find("td").eq(8).text()),E.NatLastM=parseFloat(C.eq(D).find("td").eq(9).text()),E.IntFirstF=parseFloat(C.eq(D).find("td").eq(10).text()),E.IntFirstM=parseFloat(C.eq(D).find("td").eq(11).text()),E.IntLastF=parseFloat(C.eq(D).find("td").eq(12).text()),E.IntLastM=parseFloat(C.eq(D).find("td").eq(13).text()),E.FMRatio=parseFloat(C.eq(D).find("td").eq(14).text()),h.push(E)}var F=h.length;r.push(F),p=h.map(function(a){return a.continent}),a.each(p,function(b,c){-1===a.inArray(c,q)&&q.push(c)}),d3.selectAll(".continent-select").selectAll("label").data(q.sort()).enter().append("label").attr("class","checkbox").html(function(a){var b=a.replace(/_/g," ");return"<span class='icon'></span><input type='checkbox' value='"+a+"' data-continent='"+a+"' checked>"+b}),d3.selectAll(".country-select").selectAll("label").data(h).enter().append("label").attr("class","checkbox").html(function(a){var b=a.country.replace(/_/g," ");return"<span class='icon'></span><input type='checkbox' value='"+a.country+"' data-continent='"+a.continent+"' checked>"+b+" ("+a.countryCode+")"}),d3.selectAll(".select-field input").on("change",function(){l=this.value,c(),B(l)}),d3.selectAll(".country-select input").on("change",c),d3.selectAll(".continent-select input").on("change",x),t.selectAll("rect").data(h,function(a){return a.country}).enter().append("rect").attr("width",0).attr("x",0).attr("height",0).attr("y",0);var G=d3.scale.linear().range([f,0]),H=d3.svg.axis().scale(G).tickSize(3,3).orient("left");t.append("g").attr("class","y axis").attr("transform","translate("+d.left+","+d.top+")").append("g").attr("class","axisLabel").append("text").attr("transform","rotate(-90)").attr("y",-d.left).attr("x",-f).attr("dy",".9em").style("text-anchor","left");var I=d3.scale.ordinal().domain(d3.range(h.length)).rangeRoundBands([0,e+d.right],.1);c()}})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();