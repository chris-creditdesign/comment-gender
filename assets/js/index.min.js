var allBars=["#1abc9c","#27ae60","#3498db","#5959b7","#EB6B4B"];!function(){var a=function(a){a(".outer-wrapper").css({display:"block"}),a(".status-message").css({display:"none"});var b={top:15,right:20,bottom:20,left:75},c=630-b.left-b.right,d=350-b.top-b.bottom,e=450,f=[],g=[],h=[],i="TotalPaper",j="Total papers published",k="Papers published",l=[],m=[],n=["All"],o=[],p=!0;a.getScript("/polopoly_static/js/d3.v3.min.js",function(){function q(){var b=".checkbox",c=b+" input[type='checkbox']",d=b+" input[type='radio']",e="checked";a(b).each(function(){a(this).removeClass(e)}),a(c+":checked").each(function(){a(this).parent(b).addClass(e)}),a(d+":checked").each(function(){a(this).parent(b).addClass(e)})}function r(a,b){return a.country<b.country?-1:a.country>b.country?1:0}var s=d3.select(".count-chart").append("svg").attr("width",c+b.left+b.right).attr("height",d+b.top+b.bottom),t=s.append("g").attr("transform","translate("+b.left+",0)"),u=s.append("g").attr("transform","translate("+b.left+",0)"),v=s.append("g").attr("class","x axis").attr("transform","translate("+b.left+",0)"),w=s.append("g").attr("class","axis").attr("transform","translate(-49,-5)").attr("opacity",0);w.append("rect").attr("x",c+b.left-50).attr("y",d+b.top+b.bottom-10).attr("width","10").attr("height","10").attr("opacity",.6).attr("fill","#34495e").attr("stroke","none"),w.append("text").attr("x",c+b.left-35).attr("y",d+b.top+b.bottom).style("text-anchor","start").text("Male"),w.append("rect").attr("x",c+b.left).attr("y",d+b.top+b.bottom-10).attr("width","10").attr("height","10").attr("fill","#34495e").attr("stroke","none"),w.append("text").attr("x",c+b.left+15).attr("y",d+b.top+b.bottom).style("text-anchor","start").text("Female");var x=d3.format(",");a.ajax({url:"https://poly-admin1.nature.com/preview/www/2.788/1.14321/7.14179",dataType:"text",success:function(y){function z(){for(;l.length>0;)l.shift();for(;h.length>0;)h.shift();for(;g.length>0;)g.shift();for(;g.length>0;)g.shift();for(var a=0;a<f.length;a++)h.push({});for(var b=0;b<h.length;b++)h[b].country=f[b].country,h[b].countryCode=f[b].countryCode,h[b].continent=f[b].continent;switch(i){case"TotalPaper":for(var c=0;c<h.length;c++)h[c].choice=f[c].TotalPaper,h[c].choiceFemale=0;break;case"Single":for(var d=0;d<h.length;d++)h[d].choice=f[d].SingleM,h[d].choiceFemale=f[d].SingleF;break;case"NatFirst":for(var e=0;e<h.length;e++)h[e].choice=f[e].NatFirstM,h[e].choiceFemale=f[e].NatFirstF;break;case"NatLast":for(var j=0;j<h.length;j++)h[j].choice=f[j].NatLastM,h[j].choiceFemale=f[j].NatLastF;break;case"IntFirst":for(var k=0;k<h.length;k++)h[k].choice=f[k].IntFirstM,h[k].choiceFemale=f[k].IntFirstF;break;case"IntLast":for(var m=0;m<h.length;m++)h[m].choice=f[m].IntLastM,h[m].choiceFemale=f[m].IntLastF;break;case"FMRatio":for(var n=0;n<h.length;n++)h[n].choice=f[n].FMRatio,h[n].choiceFemale=0;break;default:for(var o=0;o<h.length;o++)h[o].choice=f[o].TotalPaper,h[o].choiceFemale=0}for(var p=0;p<h.length;p++){var r=h[p].country;d3.select(".country-select [value="+r+"]").property("checked")&&l.push(h[p])}B(),E(),q()}function A(){var b=a(this).val();if("All"===b)a(".continent-select input").prop("checked",a(this).prop("checked")),a(".country-select input").prop("checked",a(this).prop("checked"));else for(var c=0;c<a(".country-select input").length;c++){var d=a(".country-select input").eq(c);b===d.data("continent")&&d.prop("checked",a(this).prop("checked"))}z()}function B(){J.domain([0,d3.max(l,function(a){return a.choice})]),l.length>5?L.domain(d3.range(l.length)):L.domain(d3.range(5));var a=t.selectAll("rect").data(l,function(a){return a.country}),c=u.selectAll("rect").data(l,function(a){return a.country});o.push(a[0].length),p=o.slice(-2)[1]>=o.slice(-2)[0]?!0:!1,o.shift(),a.enter().append("rect").attr("x",function(a,b){return L(b)}).attr("width",function(){return"TotalPaper"==i||"FMRatio"==i?L.rangeBand():L.rangeBand()/2}).attr("y",d+b.top).attr("height",0).attr("opacity",.6).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),c.enter().append("rect").attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("width",L.rangeBand()/2).attr("y",d+b.top).attr("height",0).attr("opacity",1).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),a.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)}).attr("width",function(){return"TotalPaper"==i||"FMRatio"==i?L.rangeBand():L.rangeBand()/2}).attr("y",function(a){return b.top+J(a.choice)}).attr("height",function(a){return d-J(a.choice)}),c.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("width",L.rangeBand()/2).attr("y",function(a){return b.top+J(a.choiceFemale)}).attr("height",function(a){return d-J(a.choiceFemale)}),a.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",d+b.top).attr("height",0).remove(),c.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",d+b.top).attr("height",0).remove();var f=v.selectAll("text").data(l,function(a){return a.country});f.enter().append("text").attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("y",function(){return d+b.top}).attr("text-anchor","middle").text(function(a){return a.countryCode}),f.transition().duration(e).delay(function(){return p?0:e}).attr("x",function(a,b){return L(b)+L.rangeBand()/2}).attr("y",function(a){return a.choiceFemale>=a.choice?b.top+J(a.choiceFemale)-4:b.top+J(a.choice)-4}),f.exit().transition().duration(e).attr("x",function(){return d3.select(this).attr("x")}).attr("y",d+b.top).remove(),s.select(".outer-wrapper .y").transition().duration(e).call(K),a.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(this).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(this).attr("fill","#f1c40f"),d3.select(c[0][d]).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(a,b){d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(c[0][b]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()}),c.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][d]).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(a[0][d]).attr("fill","#f1c40f"),d3.select(this).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(b,c){d3.select(a[0][c]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()}),f.on("mouseover",function(b,d){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][d]).attr("x");e=b.choiceFemale>=b.choice?d3.select(c[0][d]).attr("y"):d3.select(a[0][d]).attr("y"),d3.select(a[0][d]).attr("fill","#f1c40f"),d3.select(c[0][d]).attr("fill","#f1c40f"),C(f,g,h,i,e)}).on("mouseout",function(b,d){d3.select(a[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),d3.select(c[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return allBars[0];case"North_America":return allBars[1];case"Asia":return allBars[2];case"Europe":return allBars[3];case"South_America":return allBars[4];default:return allBars[0]}}),D()})}function C(b,c,d,f,g){var h,j="",k=b.replace(/_/g," ");h="TotalPaper"==i?x(c):c,j="TotalPaper"==i||"FMRatio"==i?k+"<br /> "+h:k+"<br />Male: "+c+"<br />Female: "+d,d3.select(".infobox").select(".value").html(j);var l=parseInt(a(".infobox").css("width"),10),m=parseInt(a(".infobox").css("height"),10),n=parseInt(f,10)-l/2+65,o=parseInt(g,10)-m-43;d3.select(".infobox").style("left",n+"px").style("top",o+"px"),d3.select(".infobox").classed("hidden",!1).transition().duration(e/2).style("opacity",1)}function D(){d3.select(".infobox").transition().duration(e/2).style("opacity",0).each("end",function(){d3.select(".infobox").classed("hidden",!0)})}function E(a){switch(a){case"TotalPaper":j="Total papers published",k="Papers published",w.transition().duration(e).attr("opacity",0);break;case"Single":j="Single",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"NatFirst":j="National first",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"NatLast":j="National last",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"IntFirst":j="International first",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"IntLast":j="International last",k="Citations",w.transition().duration(e).attr("opacity",1);break;case"FMRatio":j="Female to male ratio",k="Female to male ratio",w.transition().duration(e).attr("opacity",0)}d3.select(".outer-wrapper h1").text(j),d3.selectAll(".y .axisLabel text").text(k)}for(var F=a(y).find("tbody tr"),G=0;G<F.length;G++){var H={};H.country=F.eq(G).find("td").eq(0).text(),H.countryCode=F.eq(G).find("td").eq(1).text(),H.continent=F.eq(G).find("td").eq(2).text(),H.TotalPaper=parseInt(F.eq(G).find("td").eq(3).text(),10),H.SingleF=parseFloat(F.eq(G).find("td").eq(4).text()),H.SingleM=parseFloat(F.eq(G).find("td").eq(5).text()),H.NatFirstF=parseFloat(F.eq(G).find("td").eq(6).text()),H.NatFirstM=parseFloat(F.eq(G).find("td").eq(7).text()),H.NatLastF=parseFloat(F.eq(G).find("td").eq(8).text()),H.NatLastM=parseFloat(F.eq(G).find("td").eq(9).text()),H.IntFirstF=parseFloat(F.eq(G).find("td").eq(10).text()),H.IntFirstM=parseFloat(F.eq(G).find("td").eq(11).text()),H.IntLastF=parseFloat(F.eq(G).find("td").eq(12).text()),H.IntLastM=parseFloat(F.eq(G).find("td").eq(13).text()),H.FMRatio=parseFloat(F.eq(G).find("td").eq(14).text()),f.push(H)}var I=f.length;o.push(I),m=f.map(function(a){return a.continent}),a.each(m,function(b,c){-1===a.inArray(c,n)&&n.push(c)}),d3.selectAll(".continent-select").selectAll("label").data(n.sort()).enter().append("label").attr("class","checkbox").html(function(a){var b=a.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots "+a+"'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a+"' data-continent='"+a+"' checked>"+b}),d3.selectAll(".country-select").selectAll("label").data(f.sort(r)).enter().append("label").attr("class","checkbox").html(function(a){var b=a.country.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a.country+"' data-continent='"+a.continent+"' checked>"+b+" ("+a.countryCode+")"}),d3.selectAll(".field-select input").on("change",function(){i=this.value,z(),E(i)}),d3.selectAll(".country-select input").on("change",z),d3.selectAll(".continent-select input").on("change",A);var J=d3.scale.linear().range([d,0]),K=d3.svg.axis().scale(J).tickSize(3,3).orient("left");s.append("g").attr("class","y axis").attr("transform","translate("+b.left+","+b.top+")").append("g").attr("class","axisLabel").append("text").attr("transform","rotate(-90)").attr("y",-b.left).attr("x",-d).attr("dy",".9em").style("text-anchor","start");var L=d3.scale.ordinal().domain(d3.range(f.length)).rangeRoundBands([0,c+b.right],.4);z(),q()}})})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();