!function(){var a=function(a){a(".outer-wrapper").css({display:"block"}),a(".status-message").css({display:"none"});var b=["#1abc9c","#27ae60","#3498db","#5959b7","#EB6B4B"],c={top:15,right:20,bottom:20,left:90},d=630-c.left-c.right,e=350-c.top-c.bottom,f=450,g=[],h=[],i=[],j="TotalPaper",k="Total papers published",l="Papers published",m=[],n=[],o=["All"],p=[],q=!0;a.getScript("//www.nature.com/polopoly_static/js/d3.v3.min.js",function(){function r(){var b=".checkbox",c=b+" input[type='checkbox']",d=b+" input[type='radio']",e="checked";a(b).each(function(){a(this).removeClass(e)}),a(c+":checked").each(function(){a(this).parent(b).addClass(e)}),a(d+":checked").each(function(){a(this).parent(b).addClass(e)})}function s(a,b){return a.country<b.country?-1:a.country>b.country?1:0}var t=d3.select(".count-chart").append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom),u=t.append("g").attr("transform","translate("+c.left+",0)"),v=t.append("g").attr("transform","translate("+c.left+",0)"),w=t.append("g").attr("class","x axis").attr("transform","translate("+c.left+",0)"),x=t.append("g").attr("class","axis").attr("transform","translate(-57,-5)").attr("opacity",0);x.append("rect").attr("x",d+c.left-50).attr("y",e+c.top+c.bottom-10).attr("width","10").attr("height","10").attr("opacity",.6).attr("fill","#34495e").attr("stroke","none"),x.append("text").attr("x",d+c.left-35).attr("y",e+c.top+c.bottom).style("text-anchor","start").text("Male"),x.append("rect").attr("x",d+c.left).attr("y",e+c.top+c.bottom-10).attr("width","10").attr("height","10").attr("fill","#34495e").attr("stroke","none"),x.append("text").attr("x",d+c.left+15).attr("y",e+c.top+c.bottom).style("text-anchor","start").text("Female");var y=d3.format(",");a.ajax({url:"//www.nature.com/news/gender-output-collaboration-and-citation-data-7.14179",dataType:"text",success:function(z){function A(){for(;m.length>0;)m.shift();for(;i.length>0;)i.shift();for(;h.length>0;)h.shift();for(;h.length>0;)h.shift();for(var a=0;a<g.length;a++)i.push({});for(var b=0;b<i.length;b++)i[b].country=g[b].country,i[b].countryCode=g[b].countryCode,i[b].continent=g[b].continent;switch(j){case"TotalPaper":for(var c=0;c<i.length;c++)i[c].choice=g[c].TotalPaper,i[c].choiceFemale=0;break;case"Single":for(var d=0;d<i.length;d++)i[d].choice=g[d].SingleM,i[d].choiceFemale=g[d].SingleF;break;case"NatFirst":for(var e=0;e<i.length;e++)i[e].choice=g[e].NatFirstM,i[e].choiceFemale=g[e].NatFirstF;break;case"NatLast":for(var f=0;f<i.length;f++)i[f].choice=g[f].NatLastM,i[f].choiceFemale=g[f].NatLastF;break;case"IntFirst":for(var k=0;k<i.length;k++)i[k].choice=g[k].IntFirstM,i[k].choiceFemale=g[k].IntFirstF;break;case"IntLast":for(var l=0;l<i.length;l++)i[l].choice=g[l].IntLastM,i[l].choiceFemale=g[l].IntLastF;break;case"FMRatio":for(var n=0;n<i.length;n++)i[n].choice=g[n].FMRatio,i[n].choiceFemale=0;break;default:for(var o=0;o<i.length;o++)i[o].choice=g[o].TotalPaper,i[o].choiceFemale=0}for(var p=0;p<i.length;p++){var q=i[p].country;d3.select(".country-select [value="+q+"]").property("checked")&&m.push(i[p])}C(),F(),r()}function B(){var b=a(this).val();if("All"===b)a(".continent-select input").prop("checked",a(this).prop("checked")),a(".country-select input").prop("checked",a(this).prop("checked"));else for(var c=0;c<a(".country-select input").length;c++){var d=a(".country-select input").eq(c);b===d.data("continent")&&d.prop("checked",a(this).prop("checked"))}A()}function C(){switch(j){case"TotalPaper":case"FMRatio":K.domain([0,d3.max(m,function(a){return a.choice})]);break;case"Single":case"NatFirst":case"NatLast":case"IntFirst":case"IntLast":K.domain([0,1.7]);break;default:K.domain([0,d3.max(m,function(a){return a.choice})])}m.length>5?M.domain(d3.range(m.length)):M.domain(d3.range(5));var a=u.selectAll("rect").data(m,function(a){return a.country}),d=v.selectAll("rect").data(m,function(a){return a.country});p.push(a[0].length),q=p.slice(-2)[1]>=p.slice(-2)[0]?!0:!1,p.shift(),a.enter().append("rect").attr("x",function(a,b){return M(b)}).attr("width",function(){return"TotalPaper"==j||"FMRatio"==j?M.rangeBand():M.rangeBand()/2}).attr("y",e+c.top).attr("height",0).attr("opacity",.6).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d.enter().append("rect").attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("width",M.rangeBand()/2).attr("y",e+c.top).attr("height",0).attr("opacity",1).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),a.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)}).attr("width",function(){return"TotalPaper"==j||"FMRatio"==j?M.rangeBand():M.rangeBand()/2}).attr("y",function(a){return c.top+K(a.choice)}).attr("height",function(a){return e-K(a.choice)}),d.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("width",M.rangeBand()/2).attr("y",function(a){return c.top+K(a.choiceFemale)}).attr("height",function(a){return e-K(a.choiceFemale)}),a.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",e+c.top).attr("height",0).remove(),d.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("width",function(){return d3.select(this).attr("width")}).attr("y",e+c.top).attr("height",0).remove();var g=w.selectAll("text").data(m,function(a){return a.country});g.enter().append("text").attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("y",function(){return e+c.top}).attr("text-anchor","middle").text(function(a){return a.countryCode}),g.transition().duration(f).delay(function(){return q?0:f}).attr("x",function(a,b){return M(b)+M.rangeBand()/2}).attr("y",function(a){return a.choiceFemale>=a.choice?c.top+K(a.choiceFemale)-4:c.top+K(a.choice)-4}),g.exit().transition().duration(f).attr("x",function(){return d3.select(this).attr("x")}).attr("y",e+c.top).remove(),t.select(".outer-wrapper .y").transition().duration(f).call(L),a.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(this).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(this).attr("fill","#f1c40f"),d3.select(d[0][c]).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(a,c){d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(d[0][c]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()}),d.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][c]).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(a[0][c]).attr("fill","#f1c40f"),d3.select(this).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(c,d){d3.select(a[0][d]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(this).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()}),g.on("mouseover",function(b,c){var e,f=b.country,g=b.choice,h=b.choiceFemale,i=d3.select(a[0][c]).attr("x");e=b.choiceFemale>=b.choice?d3.select(d[0][c]).attr("y"):d3.select(a[0][c]).attr("y"),d3.select(a[0][c]).attr("fill","#f1c40f"),d3.select(d[0][c]).attr("fill","#f1c40f"),D(f,g,h,i,e)}).on("mouseout",function(c,e){d3.select(a[0][e]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),d3.select(d[0][e]).attr("fill",function(a){switch(a.continent){case"Australasia":return b[0];case"North_America":return b[1];case"Asia":return b[2];case"Europe":return b[3];case"South_America":return b[4];default:return b[0]}}),E()})}function D(b,c,d,e,g){var h,i="",k=b.replace(/_/g," ");h="TotalPaper"==j?y(c):c,i="TotalPaper"==j||"FMRatio"==j?k+"<br /> "+h:k+"<br />Male: "+c+"<br />Female: "+d,d3.select(".infobox").select(".value").html(i);var l=parseInt(a(".infobox").css("width"),10),m=parseInt(a(".infobox").css("height"),10),n=parseInt(e,10)-l/2+75,o=parseInt(g,10)-m-43;d3.select(".infobox").style("left",n+"px").style("top",o+"px"),d3.select(".infobox").classed("hidden",!1).transition().duration(f/2).style("opacity",1)}function E(){d3.select(".infobox").transition().duration(f/2).style("opacity",0).each("end",function(){d3.select(".infobox").classed("hidden",!0)})}function F(){switch(j){case"TotalPaper":k="Total papers published",l="Papers published",x.transition().duration(f).attr("opacity",0);break;case"Single":k="Single author",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"NatFirst":k="First author (national collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"NatLast":k="Last author (national collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"IntFirst":k="First author (international collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"IntLast":k="Last author (international collaboration)",l="Average relative citation (field normalized)",x.transition().duration(f).attr("opacity",1);break;case"FMRatio":k="Ratio of female to male authorships",l="Ratio of female to male authorships",x.transition().duration(f).attr("opacity",0);break;default:k="Total papers published",l="Papers published",x.transition().duration(f).attr("opacity",1)}d3.select(".outer-wrapper h3").text(k),d3.selectAll(".y .axisLabel text").text(l)}for(var G=a(z).find("tbody tr"),H=0;H<G.length;H++){var I={};I.country=G.eq(H).find("td").eq(0).text(),I.countryCode=G.eq(H).find("td").eq(1).text(),I.continent=G.eq(H).find("td").eq(2).text(),I.TotalPaper=parseInt(G.eq(H).find("td").eq(3).text(),10),I.SingleF=parseFloat(G.eq(H).find("td").eq(4).text()),I.SingleM=parseFloat(G.eq(H).find("td").eq(5).text()),I.NatFirstF=parseFloat(G.eq(H).find("td").eq(6).text()),I.NatFirstM=parseFloat(G.eq(H).find("td").eq(7).text()),I.NatLastF=parseFloat(G.eq(H).find("td").eq(8).text()),I.NatLastM=parseFloat(G.eq(H).find("td").eq(9).text()),I.IntFirstF=parseFloat(G.eq(H).find("td").eq(10).text()),I.IntFirstM=parseFloat(G.eq(H).find("td").eq(11).text()),I.IntLastF=parseFloat(G.eq(H).find("td").eq(12).text()),I.IntLastM=parseFloat(G.eq(H).find("td").eq(13).text()),I.FMRatio=parseFloat(G.eq(H).find("td").eq(14).text()),g.push(I)}var J=g.length;p.push(J),n=g.map(function(a){return a.continent}),a.each(n,function(b,c){-1===a.inArray(c,o)&&o.push(c)}),d3.selectAll(".continent-select").selectAll("label").data(o.sort()).enter().append("label").attr("class","checkbox").html(function(a){var b=a.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots "+a+"'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a+"' data-continent='"+a+"' checked>"+b}),d3.selectAll(".country-select").selectAll("label").data(g.sort(s)).enter().append("label").attr("class","checkbox").html(function(a){var b=a.country.replace(/_/g," ");return"<span class='icon'>	<svg height='20' width='20'><circle cx='10' cy='10' r='10' class='dots'></circle><polygon fill='#ECF0F1' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span><input type='checkbox' value='"+a.country+"' data-continent='"+a.continent+"' checked>"+b+" ("+a.countryCode+")"}),d3.selectAll(".field-select input").on("change",function(){j=this.value,A(),F(j)}),d3.selectAll(".country-select input").on("change",A),d3.selectAll(".continent-select input").on("change",B);var K=d3.scale.linear().range([e,0]),L=d3.svg.axis().scale(K).tickSize(3,3).orient("left");t.append("g").attr("class","y axis").attr("transform","translate("+c.left+","+c.top+")").append("g").attr("class","axisLabel").append("text").attr("transform","rotate(-90)").attr("y",15-c.left).attr("x",-e).attr("dy",".9em").style("text-anchor","start");var M=d3.scale.ordinal().domain(d3.range(g.length)).rangeRoundBands([0,d+c.right],.4);A(),r()}})})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();